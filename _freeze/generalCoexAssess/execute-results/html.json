{
  "hash": "f45a96f20e9e38c3c2c3ee211a92f6f9",
  "result": {
    "markdown": "---\ntitle: \"General Coex Evaluation\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(gghalves)\nlibrary(ggstatsplot)\nlibrary(\"gridExtra\")\nlibrary(cowplot)\nlibrary(Matrix)\nlibrary(ggstance)\n#library(COTAN)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngenesList <- list(\n  \"NPGs\"= \n    c(\"Nes\", \"Vim\", \"Sox2\", \"Sox1\", \"Notch1\", \"Hes1\", \"Hes5\", \"Pax6\"),\n  \"PNGs\"= \n    c(\"Map2\", \"Tubb3\", \"Neurod1\", \"Nefm\", \"Nefl\", \"Dcx\", \"Tbr1\"),\n  \"hk\"= \n    c(\"Calm1\", \"Cox6b1\", \"Ppia\", \"Rpl18\", \"Cox7c\", \"Erh\", \"H3f3a\",\n      \"Taf1\", \"Taf2\", \"Gapdh\", \"Actb\", \"Golph3\", \"Zfr\", \"Sub1\",\n      \"Tars\", \"Amacr\"),\n  \"layers\" = \n    c(\"Reln\",\"Lhx5\",\"Cux1\",\"Satb2\",\"Tle1\",\"Mef2c\",\"Rorb\",\"Sox5\",\"Bcl11b\",\"Fezf2\",\"Foxp2\")\n)\n```\n:::\n\n\n## COEX and Correlations\n\nImport COTAN coex and correlations data from file\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable.tot.hk <- NA\ntable.tot.neural <- NA\nfor (file in list.files(\"CoexData/\",pattern = \"Corr|Coex\")) {\n  corr <- readRDS(paste0(\"CoexData/\",file))\n  corr <- as.data.frame(as.matrix(corr))\n  if(str_detect(file,pattern = \"CotanCoex\")){\n    code <- \"COTAN coex\"\n  }else if(str_detect(file,pattern = \"CorrSCT\")){\n    code <- \"Seurat SCT corr.\"\n  }else if(str_detect(file,pattern = \"Corr\")){\n    code <- \"Seurat corr.\"\n  }\n  \n  \n  table.hk <- as.data.frame(corr[,genesList$hk])\n  table.hk$Gene1 <- rownames(table.hk)\n  \n  table.hk <- pivot_longer(as.data.frame(table.hk),cols = c(1:(ncol(table.hk)-1)),names_to = \"Gene2\")\n  table.hk$Method <- code\n\n  table.tot.hk <- rbind(table.tot.hk,table.hk)\n  table.tot.hk <- table.tot.hk[! table.tot.hk$Gene1 == table.tot.hk$Gene2,]\n \n  #Not hk\n  table.neural <- as.data.frame(corr[rownames(corr) %in% c(genesList$NPGs,genesList$PNGs,genesList$layers),colnames(corr) %in% c(genesList$NPGs,genesList$PNGs,genesList$layers)])\n  table.neural$Gene1 <- rownames(table.neural)\n  \n  table.neural <- pivot_longer(as.data.frame(table.neural),cols = c(1:(ncol(table.neural)-1)),names_to = \"Gene2\")\n  table.neural$Method <- code\n  \n  table.tot.neural <- rbind(table.tot.neural,table.neural)\n  table.tot.neural <- table.tot.neural[! table.tot.neural$Gene1 == table.tot.neural$Gene2,]\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable.tot.hk <- table.tot.hk[2:nrow(table.tot.hk),]\ntable.tot.hk$GeneType <- \"Constitutive\" \ntable.tot.neural <- table.tot.neural[2:nrow(table.tot.neural),]\ntable.tot.neural$GeneType <- \"Neural\"\n\n## For ECDL\ntmp.tot <- NA\nfor (method in unique(table.tot.hk$Method)) {\n  tmp <- as.data.frame(table.tot.hk[table.tot.hk$Method == method,])\n  tmp$n <- NA\n  tmp[order(abs(tmp$value)),]$n <- c(1:dim(tmp)[1])/(dim(tmp)[1]+1)\n  tmp$Y_axis <- 1-tmp$n\n  tmp.tot <- rbind(tmp.tot,tmp)\n}\ntmp.tot <- tmp.tot[2:nrow(tmp.tot),]\ntable.tot.hk <- tmp.tot\n\ntmp.tot <- NA\nfor (method in unique(table.tot.neural$Method)) {\n  tmp <- as.data.frame(table.tot.neural[table.tot.neural$Method == method,])\n  tmp$n <- NA\n  tmp[order(abs(tmp$value)),]$n <- c(1:dim(tmp)[1])/(dim(tmp)[1]+1)\n  tmp$Y_axis <- 1-tmp$n\n  tmp.tot <- rbind(tmp.tot,tmp)\n}\ntmp.tot <- tmp.tot[2:nrow(tmp.tot),]\ntable.tot.neural <- tmp.tot\n\n############\n\ntable.tot <- rbind(table.tot.hk,table.tot.neural) \ntable.tot <- table.tot[!table.tot$Gene1 == table.tot$Gene2,]\n\nidentical(table.tot[table.tot$Method == \"COTAN coex\",]$Gene1,\n          table.tot[table.tot$Method == \"Seurat corr.\",]$Gene1 )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\nidentical(table.tot[table.tot$Method == \"COTAN coex\",]$Gene2,\n          table.tot[table.tot$Method == \"Seurat corr.\",]$Gene2 )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\nhead(table.tot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Gene1  Gene2        value     Method     GeneType         n    Y_axis\n2  Actb  Calm1 -0.046654038 COTAN coex Constitutive 0.7526141 0.2473859\n3  Actb Cox6b1  0.029446301 COTAN coex Constitutive 0.5804642 0.4195358\n4  Actb   Ppia -0.032311039 COTAN coex Constitutive 0.6179546 0.3820454\n5  Actb  Rpl18  0.022841098 COTAN coex Constitutive 0.5006376 0.4993624\n6  Actb  Cox7c  0.008585828 COTAN coex Constitutive 0.2175465 0.7824535\n7  Actb    Erh  0.012658061 COTAN coex Constitutive 0.2994134 0.7005866\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable.tot$ValAbs <- abs(table.tot$value)\ntable.tot$LogValAbs <- log(table.tot$ValAbs+0.001)\ntable.tot$SqrValAbs <- table.tot$ValAbs**2\n\nggplot(table.tot,aes(x=Method,y=LogValAbs, fill=Method)) +\ngeom_half_violin(alpha=0.8) +\n  #geom_point(position = \"jitter\", size= 0.1,alpha = 0.3)+ \n  geom_half_boxplot(width=0.1, alpha=0.8,side = \"r\") +\n  theme_bw()+   theme(legend.position=\"none\")+#ylim(0,1)+\n  facet_grid(GeneType ~ . , space = \"free_y\", scales = \"free\")+\n  scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot[table.tot$GeneType == \"Neural\",], aes(x = ValAbs, y = -0.5)) +\n\n  # horizontal box plot\n  geom_boxploth(aes(fill = Method)) +\n\n  # normal density plot\n  geom_density(aes(x = ValAbs), inherit.aes = FALSE) +\n\n  # # vertical lines at Q1 / Q2 / Q3\n  # stat_boxploth(geom = \"vline\", aes(xintercept = ..xlower..)) +\n   stat_boxploth(geom = \"vline\", aes(xintercept = ..xmiddle..)) +\n  # stat_boxploth(geom = \"vline\", aes(xintercept = ..xupper..)) +\n  # \n   facet_grid(Method ~ .) +\n  \n  # reproduce original chart's color scale (o/w ordered factors will result\n  # in viridis scale by default, using the current version of ggplot2)\n  scale_fill_discrete()+scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))+\n  theme_bw()+   theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot[table.tot$GeneType == \"Constitutive\",], aes(x = ValAbs, y = -0.5)) +\n\n  # horizontal box plot\n  geom_boxploth(aes(fill = Method), outlier.size = 0.5,width=3) +\n\n  # normal density plot\n  geom_density(aes(x = ValAbs), inherit.aes = FALSE) +\n\n  # # vertical lines at Q1 / Q2 / Q3\n  # stat_boxploth(geom = \"vline\", aes(xintercept = ..xlower..)) +\n   stat_boxploth(geom = \"vline\", aes(xintercept = ..xmiddle..)) +\n  # stat_boxploth(geom = \"vline\", aes(xintercept = ..xupper..)) +\n  # \n   facet_grid(Method ~ .) +\n  \n  # reproduce original chart's color scale (o/w ordered factors will result\n  # in viridis scale by default, using the current version of ggplot2)\n  scale_fill_discrete()+scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))+\n  theme_bw()+   theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)\nggplot(table.tot,aes(x=ValAbs, color=Method, y = Y_axis)) + \n  geom_point(alpha=0.8) +\n  scale_color_manual(values = c(\"#8856A7\",\"gray\",\"#B3CDE3\" ))+\n  scale_y_continuous(trans= \"log\",breaks = c(0,0.1,0.25,0.5)\n                         )+\n  scale_x_continuous(trans= \"log\",\n                     breaks = c(0.1,0.2,0.3, 0.4,0.5,0.8), limits = c(0.01,0.85))+\n  theme_bw()+   theme(legend.position=\"bottom\")+ \n  facet_grid(GeneType ~ . )\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot.hk,aes(x=abs(value), color=Method))+stat_ecdf(geom = \"point\", size = 0.5 )+\n  scale_y_continuous(trans= \"exp\")\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot,aes(x=Method,y=ValAbs, fill=Method)) +\n#geom_half_boxplot(alpha=0.8) +\n  #geom_point(position = \"jitter\", size= 0.1,alpha = 0.3)+ \n  geom_boxplot(alpha=0.8,outlier.size = 0.1,outlier.colour='blue', alpha=0.1) +\n  theme_bw()+   theme(legend.position=\"none\")+ylim(0,0.2)+\n  facet_grid(GeneType ~ . , space = \"free_y\", scales = \"free\")+\n  scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot,aes(x=Method,y=ValAbs, fill=GeneType)) +\n  geom_boxplot(alpha=0.8) +\n  #geom_hline(yintercept = -3.39)+\n  #geom_hline(yintercept = -1.86)+\n  #geom_point(position = \"jitter\", size= 0.1,alpha = 0.3)+ \n  #geom_half_boxplot(width=0.1, alpha=0.8,side = \"r\") +\n  theme_bw()+   #theme(legend.position=\"none\")+\n  scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot, aes(x=Method,y=ValAbs, fill=GeneType)) +\n  introdataviz::geom_split_violin(alpha = .4, trim = FALSE) +\n  geom_boxplot(width = .2, alpha = .6, fatten = NULL, show.legend = FALSE) +\n  stat_summary(fun.data = \"mean_se\", geom = \"pointrange\", show.legend = F, \n               position = position_dodge(.175)) +\n scale_fill_brewer(palette = \"Dark2\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## p-values evaluation\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable.tot.hk <- NA\ntable.tot.neural <- NA\nfor (file in list.files(\"CoexData/\",pattern = \"PValue\")) {\n  pval <- readRDS(paste0(\"CoexData/\",file))\n  #pval <- as.data.frame(as.matrix(pval))\n  if(str_detect(file,pattern = \"Cotan\")){\n    code <- \"COTAN p-val\"\n    if(all(diag(pval)) == 1){\n      \n      diag(pval) = 0\n    }\n  }else if(str_detect(file,pattern = \"PValuesSCT\")){\n    code <- \"Seurat SCT p-val.\"\n  }else if(str_detect(file,pattern = \"SeuratPValues\")){\n    code <- \"Seurat p-val.\"\n  }\n  \n  \n  table.hk <- as.data.frame(pval[,genesList$hk])\n  table.hk$Gene1 <- rownames(table.hk)\n  \n  table.hk <- pivot_longer(as.data.frame(table.hk),cols = c(1:(ncol(table.hk)-1)),names_to = \"Gene2\")\n  table.hk$Method <- code\n\n  table.tot.hk <- rbind(table.tot.hk,table.hk)\n  table.tot.hk <- table.tot.hk[! table.tot.hk$Gene1 == table.tot.hk$Gene2,]\n \n  #Not hk\n  table.neural <- as.data.frame(pval[rownames(pval) %in% c(genesList$NPGs,genesList$PNGs,genesList$layers),colnames(pval) %in% c(genesList$NPGs,genesList$PNGs,genesList$layers)])\n  table.neural$Gene1 <- rownames(table.neural)\n  \n  table.neural <- pivot_longer(as.data.frame(table.neural),cols = c(1:(ncol(table.neural)-1)),names_to = \"Gene2\")\n  table.neural$Method <- code\n  \n  table.tot.neural <- rbind(table.tot.neural,table.neural)\n  table.tot.neural <- table.tot.neural[! table.tot.neural$Gene1 == table.tot.neural$Gene2,]\n}\n\ntable.tot.hk <- table.tot.hk[2:nrow(table.tot.hk),]\ntable.tot.hk$GeneType <- \"Constitutive\" \ntable.tot.neural <- table.tot.neural[2:nrow(table.tot.neural),]\ntable.tot.neural$GeneType <- \"Neural\"\n\n## For ECDL\ntmp.tot <- NA\nfor (method in unique(table.tot.hk$Method)) {\n  tmp <- as.data.frame(table.tot.hk[table.tot.hk$Method == method,])\n  tmp$n <- NA\n  tmp[order(abs(tmp$value)),]$n <- c(1:dim(tmp)[1])/(dim(tmp)[1]+1)\n  tmp$Y_axis <- 1-tmp$n\n  tmp.tot <- rbind(tmp.tot,tmp)\n}\ntmp.tot <- tmp.tot[2:nrow(tmp.tot),]\ntable.tot.hk <- tmp.tot\n\ntmp.tot <- NA\nfor (method in unique(table.tot.neural$Method)) {\n  tmp <- as.data.frame(table.tot.neural[table.tot.neural$Method == method,])\n  tmp$n <- NA\n  tmp[order(abs(tmp$value)),]$n <- c(1:dim(tmp)[1])/(dim(tmp)[1]+1)\n  tmp$Y_axis <- 1-tmp$n\n  tmp.tot <- rbind(tmp.tot,tmp)\n}\ntmp.tot <- tmp.tot[2:nrow(tmp.tot),]\ntable.tot.neural <- tmp.tot\n\n############\n\ntable.tot <- rbind(table.tot.hk,table.tot.neural) \ntable.tot <- table.tot[!table.tot$Gene1 == table.tot$Gene2,]\n\nidentical(table.tot[table.tot$Method == \"COTAN p-val\",]$Gene1,\n          table.tot[table.tot$Method == \"Seurat p-val.\",]$Gene1 )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n\n```{.r .cell-code}\nhead(table.tot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Gene1  Gene2     value      Method     GeneType         n    Y_axis\n2  Actb  Calm1 0.1221210 COTAN p-val Constitutive 0.3808790 0.6191210\n3  Actb Cox6b1 0.3291958 COTAN p-val Constitutive 0.5774865 0.4225135\n4  Actb   Ppia 0.2843218 COTAN p-val Constitutive 0.5350810 0.4649190\n5  Actb  Rpl18 0.4491310 COTAN p-val Constitutive 0.6437934 0.3562066\n6  Actb  Cox7c 0.7760267 COTAN p-val Constitutive 0.8681573 0.1318427\n7  Actb    Erh 0.6748957 COTAN p-val Constitutive 0.8080185 0.1919815\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot[table.tot$GeneType == \"Constitutive\",], aes(y = value)) +\n\n  # horizontal box plot\n  geom_boxplot(aes(fill = Method), outlier.size = 0.5,width=3) +\n\n  # reproduce original chart's color scale (o/w ordered factors will result\n  # in viridis scale by default, using the current version of ggplot2)\n  scale_fill_discrete()+scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))+\n  theme_bw()+   theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(table.tot[table.tot$GeneType == \"Neural\",], aes(y = log(value))) +\n\n  # horizontal box plot\n  geom_boxplot(aes(fill = Method), outlier.size = 0.5,width=3) +\n\n  # reproduce original chart's color scale (o/w ordered factors will result\n  # in viridis scale by default, using the current version of ggplot2)\n  scale_fill_discrete()+scale_fill_manual(values = c(\"#8856A7\",\"#EDF8FB\",\"#B3CDE3\" ))+\n  theme_bw()+   theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![](generalCoexAssess_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 20.04.6 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 \nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0\n\nlocale:\n [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       \n [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   \n [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          \n[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   \n\ntime zone: Europe/Rome\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scales_1.2.1       ggstance_0.3.6     Matrix_1.6-0       cowplot_1.1.1     \n [5] gridExtra_2.3      ggstatsplot_0.12.0 gghalves_0.1.4     ggplot2_3.4.2     \n [9] stringr_1.5.0      tidyr_1.3.0       \n\nloaded via a namespace (and not attached):\n [1] utf8_1.2.3              generics_0.1.3          stringi_1.7.12         \n [4] lattice_0.21-8          digest_0.6.33           magrittr_2.0.3         \n [7] correlation_0.8.4       RColorBrewer_1.1-3      evaluate_0.21          \n[10] grid_4.3.1              estimability_1.4.1      mvtnorm_1.2-2          \n[13] fastmap_1.1.1           plyr_1.8.8              jsonlite_1.8.7         \n[16] rematch2_2.1.2          purrr_1.0.1             fansi_1.0.4            \n[19] introdataviz_0.0.0.9003 cli_3.6.1               rlang_1.1.1            \n[22] munsell_0.5.0           withr_2.5.0             yaml_2.3.7             \n[25] statsExpressions_1.5.1  tools_4.3.1             datawizard_0.8.0       \n[28] coda_0.19-4             dplyr_1.1.2             colorspace_2.1-0       \n[31] zeallot_0.1.0           bayestestR_0.13.1       paletteer_1.5.0        \n[34] vctrs_0.6.3             R6_2.5.1                lifecycle_1.0.3        \n[37] emmeans_1.8.7           htmlwidgets_1.6.2       insight_0.19.3         \n[40] pkgconfig_2.0.3         pillar_1.9.0            gtable_0.3.3           \n[43] Rcpp_1.0.11             glue_1.6.2              xfun_0.39              \n[46] tibble_3.2.1            tidyselect_1.2.0        rstudioapi_0.15.0      \n[49] parameters_0.21.1       knitr_1.43              farver_2.1.1           \n[52] xtable_1.8-4            patchwork_1.1.2         htmltools_0.5.5        \n[55] labeling_0.4.2          rmarkdown_2.24          compiler_4.3.1         \n```\n:::\n:::\n",
    "supporting": [
      "generalCoexAssess_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}