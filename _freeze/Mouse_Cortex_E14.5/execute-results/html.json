{
  "hash": "5b9ed310a7aeaf656fa48ad57166a4b5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"E14.5 Mouse Cortex Loo 2019\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(parallelly.fork.enable = TRUE)\nlibrary(COTAN)\nlibrary(zeallot)\nlibrary(data.table)\nlibrary(factoextra)\nlibrary(Rtsne)\nlibrary(qpdf)\nlibrary(stringr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ne14_dge = read.table(\"Data/MouseCortex/OriginalData/E14_combined_matrix.txt.gz\",header=T,sep=\"\\t\",row.names=1)\n\nprint(dim(e14_dge))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 21313 11069\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noutDir <- \"Data/MouseCortex/\"\nsetLoggingLevel(1)\nsetLoggingFile(file.path(outDir, \"Dataset.log\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncond <- \"MouseCortex_E14.5\"\nobj <- COTAN(raw = e14_dge)\nobj <- initializeMetaDataset(obj,\n                             GEO = \"GSE123335\",\n                             sequencingMethod = \"Drop_seq\",\n                             sampleCondition = cond)\n\nCellCond <- str_split(getCells(obj),pattern = \"_\",simplify = T)[,1]\nnames(CellCond) <- getCells(obj)\nobj <- addCondition(obj,\"CellCond\",CellCond)\n\nrm(e14_dge)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nECDPlot(obj, yCut = 400L)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncellSizePlot(obj,condName = \"CellCond\")\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngenesSizePlot(obj,condName = \"CellCond\")\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmit <- mitochondrialPercentagePlot(obj, genePrefix = \"^mt-\",condName = \"CellCond\")\nmit[[\"plot\"]]\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\nTo drop cells by cell library size:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncells_to_rem <- getCells(obj)[getCellsSize(obj) > 15000]\nobj <- dropGenesCells(obj, cells = cells_to_rem)\ncellSizePlot(obj,condName = \"CellCond\")\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngenesSizePlot(obj,condName = \"CellCond\")\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\nTo drop cells by mitochondrial percentage:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nto_rem <- mit[[\"sizes\"]][[\"mit.percentage\"]] > 7.5\ncells_to_rem <- rownames(mit[[\"sizes\"]])[to_rem]\nobj <- dropGenesCells(obj, cells = cells_to_rem)\n\nmit <- mitochondrialPercentagePlot(obj, genePrefix = \"^mt-\",condName = \"CellCond\")\n\nmit[[\"plot\"]]\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncellSizePlot(obj,condName = \"CellCond\")\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nobj <- clean(obj)\nc(pcaCellsPlot, pcaCellsData, genesPlot, UDEPlot, nuPlot, zoom) %<-% cleanPlots(obj)\n\npcaCellsPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngenesPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncells_to_rem <- rownames(pcaCellsData)[pcaCellsData[[\"groups\"]] == \"B\"]\nobj <- dropGenesCells(obj, cells = cells_to_rem)\nobj <- clean(obj)\nc(pcaCellsPlot, pcaCellsData, genesPlot, UDEPlot, nuPlot, zoom) %<-% cleanPlots(obj)\n\npcaCellsPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n genesPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(nuPlot)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnuDf <- data.frame(\"nu\" = sort(getNu(obj)), \"n\" = seq_along(getNu(obj)))\nyset <- 0.18 # the threshold to remove low UDE cells\nplot.ude <- ggplot(nuDf, aes(x = n, y = nu)) +\n            geom_point(colour = \"#8491B4B2\", size = 1.0) +\n            xlim(0L, 3000) +\n            ylim(0.0, 1.0) +\n            geom_hline(yintercept = yset, linetype = \"dashed\",\n                       color = \"darkred\") +\n            annotate(geom = \"text\", x = 1000L, y = 0.25,\n                     label = paste0(\"to remove cells with nu < \", yset),\n                     color = \"darkred\", size = 4.5)\n\nplot.ude\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nobj <- addElementToMetaDataset(obj, \"Threshold low UDE cells:\", yset)\n\ncells_to_rem <- rownames(nuDf)[nuDf[[\"nu\"]] < yset]\nobj <- dropGenesCells(obj, cells = cells_to_rem)\nobj <- clean(obj)\nc(pcaCellsPlot, pcaCellsData, genesPlot, UDEPlot, nuPlot, zoom) %<-% cleanPlots(obj)\n\npcaCellsPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngenesPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nUDEPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnuPlot\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nUDEPlot$data$Sample <- str_split(rownames(UDEPlot$data),pattern = \"_\",simplify = T)[,1]\n\nggplot(UDEPlot$data, aes(PC1,PC2,color = Sample)) + geom_point(size = 0.5, alpha=0.7)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(UDEPlot$data, aes(PC2,PC3,color = Sample)) + geom_point(size = 0.5, alpha=0.7)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(UDEPlot$data, aes(PC2,PC5,color = Sample)) + geom_point(size = 0.5, alpha=0.7)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(UDEPlot$data, aes(PC2,PC5,color = groups)) + geom_point(size = 0.5, alpha=0.7)\n```\n\n::: {.cell-output-display}\n![](Mouse_Cortex_E14.5_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n\n## COTAN analysis\n\nIn this part, all the contingency tables are computed and used to get the statistics.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobj <- estimateLambdaLinear(obj)\nobj <- estimateDispersionBisection(obj, cores = 15L)\n```\n:::\n\n\n\n\n`COEX` evaluation and storing\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobj <- calculateCoex(obj)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# saving the structure\nsaveRDS(obj, file = file.path(outDir, paste0(cond, \".cotan.RDS\")))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nobjTemp <- obj\nobj <- readRDS(file = file.path(outDir, paste0(cond, \".cotan.RDS\")))\n```\n:::\n\n\n\n\n(Next code... just check that the already stored data is identical to the re-calculated)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nidentical(getRawData(obj),getRawData(objTemp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.2 (2025-10-31)\nPlatform: x86_64-pc-linux-gnu\nRunning under: Ubuntu 22.04.5 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 \nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0  LAPACK version 3.10.0\n\nlocale:\n [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       \n [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   \n [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          \n[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   \n\ntime zone: Europe/Rome\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] stringr_1.5.1     qpdf_1.3.5        Rtsne_0.17        factoextra_1.0.7 \n[5] ggplot2_4.0.1     data.table_1.17.0 zeallot_0.2.0     COTAN_2.9.4      \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22            splines_4.5.2              \n  [3] later_1.4.2                 tibble_3.3.0               \n  [5] polyclip_1.10-7             fastDummies_1.7.5          \n  [7] lifecycle_1.0.4             doParallel_1.0.17          \n  [9] globals_0.18.0              lattice_0.22-7             \n [11] MASS_7.3-65                 dendextend_1.19.0          \n [13] magrittr_2.0.4              plotly_4.11.0              \n [15] rmarkdown_2.29              yaml_2.3.10                \n [17] httpuv_1.6.16               Seurat_5.2.1               \n [19] sctransform_0.4.2           askpass_1.2.1              \n [21] spam_2.11-1                 sp_2.2-0                   \n [23] spatstat.sparse_3.1-0       reticulate_1.42.0          \n [25] cowplot_1.1.3               pbapply_1.7-2              \n [27] RColorBrewer_1.1-3          abind_1.4-8                \n [29] GenomicRanges_1.60.0        purrr_1.2.0                \n [31] BiocGenerics_0.54.0         circlize_0.4.16            \n [33] GenomeInfoDbData_1.2.14     IRanges_2.42.0             \n [35] S4Vectors_0.46.0            ggrepel_0.9.6              \n [37] irlba_2.3.5.1               listenv_0.9.1              \n [39] spatstat.utils_3.1-4        goftest_1.2-3              \n [41] RSpectra_0.16-2             spatstat.random_3.4-1      \n [43] fitdistrplus_1.2-2          parallelly_1.45.0          \n [45] codetools_0.2-20            DelayedArray_0.34.1        \n [47] tidyselect_1.2.1            shape_1.4.6.1              \n [49] UCSC.utils_1.4.0            farver_2.1.2               \n [51] ScaledMatrix_1.16.0         viridis_0.6.5              \n [53] matrixStats_1.5.0           stats4_4.5.2               \n [55] spatstat.explore_3.4-2      jsonlite_2.0.0             \n [57] GetoptLong_1.0.5            gghalves_0.1.4             \n [59] progressr_0.15.1            ggridges_0.5.6             \n [61] survival_3.8-3              iterators_1.0.14           \n [63] foreach_1.5.2               tools_4.5.2                \n [65] ica_1.0-3                   Rcpp_1.0.14                \n [67] glue_1.8.0                  gridExtra_2.3              \n [69] SparseArray_1.8.0           xfun_0.52                  \n [71] MatrixGenerics_1.20.0       ggthemes_5.1.0             \n [73] GenomeInfoDb_1.44.0         dplyr_1.1.4                \n [75] withr_3.0.2                 fastmap_1.2.0              \n [77] digest_0.6.37               rsvd_1.0.5                 \n [79] parallelDist_0.2.6          R6_2.6.1                   \n [81] mime_0.13                   colorspace_2.1-1           \n [83] scattermore_1.2             tensor_1.5                 \n [85] spatstat.data_3.1-6         tidyr_1.3.1                \n [87] generics_0.1.3              httr_1.4.7                 \n [89] htmlwidgets_1.6.4           S4Arrays_1.8.0             \n [91] uwot_0.2.3                  pkgconfig_2.0.3            \n [93] gtable_0.3.6                ComplexHeatmap_2.24.0      \n [95] lmtest_0.9-40               S7_0.2.1                   \n [97] SingleCellExperiment_1.30.0 XVector_0.48.0             \n [99] htmltools_0.5.8.1           dotCall64_1.2              \n[101] zigg_0.0.2                  clue_0.3-66                \n[103] SeuratObject_5.1.0          scales_1.4.0               \n[105] Biobase_2.68.0              png_0.1-8                  \n[107] spatstat.univar_3.1-3       knitr_1.50                 \n[109] reshape2_1.4.4              rjson_0.2.23               \n[111] nlme_3.1-168                proxy_0.4-27               \n[113] zoo_1.8-14                  GlobalOptions_0.1.2        \n[115] KernSmooth_2.23-26          parallel_4.5.2             \n[117] miniUI_0.1.2                pillar_1.10.2              \n[119] grid_4.5.2                  vctrs_0.6.5                \n[121] RANN_2.6.2                  promises_1.3.2             \n[123] BiocSingular_1.24.0         beachmat_2.24.0            \n[125] xtable_1.8-4                cluster_2.1.8.1            \n[127] evaluate_1.0.3              cli_3.6.5                  \n[129] compiler_4.5.2              rlang_1.1.6                \n[131] crayon_1.5.3                future.apply_1.20.0        \n[133] labeling_0.4.3              plyr_1.8.9                 \n[135] stringi_1.8.7               viridisLite_0.4.2          \n[137] deldir_2.0-4                BiocParallel_1.42.0        \n[139] assertthat_0.2.1            lazyeval_0.2.2             \n[141] spatstat.geom_3.4-1         Matrix_1.7-4               \n[143] RcppHNSW_0.6.0              patchwork_1.3.2            \n[145] future_1.58.0               shiny_1.11.0               \n[147] SummarizedExperiment_1.38.1 ROCR_1.0-11                \n[149] Rfast_2.1.5.1               igraph_2.1.4               \n[151] RcppParallel_5.1.10        \n```\n\n\n:::\n:::",
    "supporting": [
      "Mouse_Cortex_E14.5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}