{
  "hash": "5992404dac92023505f744feda4cb1ce",
  "result": {
    "markdown": "---\ntitle: \"CD14+ clusterizations comparisons with CellTypist\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n#library(SingleCellExperiment)\n#library(DuoClustering2018)\n#library(tidyr)\nlibrary(rlang)\nlibrary(ggplot2)\nlibrary(ggsankey) # remotes::install_github(\"davidsjoberg/ggsankey\")\nlibrary(tibble)\nlibrary(zeallot)\nlibrary(assertthat)\nlibrary(COTAN)\nlibrary(caret)\ntheme_set(theme_bw())\nlibrary(stringr)\nlibrary(nnet)\n#devtools::load_all(\"~/dev/COTAN/COTAN/\")\n\noptions(parallelly.fork.enable = TRUE)\n\noutDir <- \"Results/Clusterization/\"\n\nsetLoggingLevel(2)\nsetLoggingFile(file.path(outDir, \"CD14_Monocytes_ClusterizationsComparisons.log\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncd14Obj <- readRDS(file = file.path(\"Data/CD14Cleaned/\", \"CD14_Monocytes.cotan.RDS\"))\n\nsampleCondition <- getMetadataElement(cd14Obj, datasetTags()[[\"cond\"]])\n\nsampleCondition\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"CD14_Monocytes\"\n```\n:::\n\n```{.r .cell-code}\ngetClusterizations(cd14Obj)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"split\"           \"merge\"           \"majority-voting\"\n```\n:::\n\n```{.r .cell-code}\nmetaC <- getMetadataCells(cd14Obj)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsplitClusters <- getClusters(cd14Obj, \"split\")\nmergedClusters <- getClusters(cd14Obj, \"merge\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlabelsDF <- read.csv(file.path(\"Data/CD14Cleaned/\", \"CD14Cleaned_Immune_All_Low_predicted_labels.csv\"), header = TRUE)\nlabelsDF <- column_to_rownames(labelsDF, var = \"X\")\nrownames(labelsDF) <- gsub(\"[.]\", \"-\", rownames(labelsDF))\n\ncells_to_keep <- rownames(labelsDF)[rownames(labelsDF) %in% getCells(cd14Obj)]\nassert_that(identical(cells_to_keep, getCells(cd14Obj)))\n\nmajorityVotingClusters <- labelsDF[cells_to_keep, \"majority_voting\"]\nnames(majorityVotingClusters) <- cells_to_keep\n\nmajorityVotingCoexDF <- DEAOnClusters(cd14Obj,clName =\"majority-voting\",clusters =   majorityVotingClusters)\n\ncd14Obj <- addClusterization(cd14Obj, clName = \"majority-voting\",\n                             clusters = majorityVotingClusters,\n                             coexDF = majorityVotingCoexDF)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nSave the COTAN object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(cd14Obj, file = file.path(outDir, paste0(sampleCondition, \".cotan.RDS\")))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnlevels(splitClusters)\nhead(sort(table(splitClusters), decreasing = TRUE), 10L)\n\nnlevels(mergedClusters)\nhead(sort(table(mergedClusters), decreasing = TRUE), 10L)\n\nnlevels(majorityVotingClusters)\nhead(sort(table(majorityVotingClusters), decreasing = TRUE), 10L)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsplitClustersDF <- as.data.frame(splitClusters)\nsplitClustersDF[[\"cell\"]] <- rownames(splitClustersDF)\ncolnames(splitClustersDF)[[1]] <- \"COTAN.split.cluster\"\nsplitClustersDF <- splitClustersDF[order(splitClustersDF[[\"COTAN.split.cluster\"]]), ]\n\nmergedClustersDF <- as.data.frame(mergedClusters)\nmergedClustersDF[[\"cell\"]] <- rownames(mergedClustersDF)\ncolnames(mergedClustersDF)[[1]] <- \"COTAN.merged.cluster\"\nmergedClustersDF <- mergedClustersDF[order(mergedClustersDF[[\"COTAN.merged.cluster\"]]), ]\n\nmajorityVotingClustersDF <- as.data.frame(majorityVotingClusters)\nmajorityVotingClustersDF[[\"cell\"]] <- rownames(majorityVotingClustersDF)\ncolnames(majorityVotingClustersDF)[[1]] <- \"majority.voting.cluster\"\nmajorityVotingClustersDF <- majorityVotingClustersDF[order(majorityVotingClustersDF[[\"majority.voting.cluster\"]]), ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmjvt_split.table <- merge.data.frame(x = majorityVotingClustersDF, y = splitClustersDF,\n                                         by = \"cell\", all.x = TRUE, all.y = TRUE)\n\ntable(mjvt_split.table[,c(2L, 3L)])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       COTAN.split.cluster\nmajority.voting.cluster   1   2   3   4   5\n    Classical monocytes 877   3 637 837  48\n    NK cells              1  25   0   0   0\n    pDC                   0  10   0   0   0\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmjvt_split.table2 <- mjvt_split.table %>% make_long(majority.voting.cluster, COTAN.split.cluster)\n\nggplot(mjvt_split.table2,\n       aes(x = x,\n           next_x = next_x,\n           node = node,\n           next_node = next_node,\n           fill = factor(node),\n           label = node)) +\n  geom_sankey(flow.alpha = 0.75, node.color = 1) +\n  geom_sankey_label(size = 3.5, color = 1, fill = \"white\") +\n  scale_fill_viridis_d(option = \"A\", alpha = 0.95) +\n  theme_sankey(base_size = 16) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](cd14_clusterizations_comparisons_files/figure-html/COTAN.split.cluster.sankey.maj.voting-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmjvt_merged.table <- merge.data.frame(x = majorityVotingClustersDF, y = mergedClustersDF,\n                                         by = \"cell\", all.x = TRUE, all.y = TRUE)\n\ntable(mjvt_merged.table[,c(2L, 3L)])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       COTAN.merged.cluster\nmajority.voting.cluster    1    2    3\n    Classical monocytes 1522  877    3\n    NK cells               0    1   25\n    pDC                    0    0   10\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmjvt_merged.table2 <- mjvt_merged.table %>% make_long(majority.voting.cluster, COTAN.merged.cluster)\n\nggplot(mjvt_merged.table2,\n       aes(x = x,\n           next_x = next_x,\n           node = node,\n           next_node = next_node,\n           fill = factor(node),\n           label = node)) +\n  geom_sankey(flow.alpha = 0.75, node.color = 1) +\n  geom_sankey_label(size = 3.5, color = 1, fill = \"white\") +\n  scale_fill_viridis_d(option = \"A\", alpha = 0.95) +\n  theme_sankey(base_size = 16) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](cd14_clusterizations_comparisons_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmarkersCD14 <- findClustersMarkers(cd14Obj,n = 100,clName = \"merge\",method = \"BH\")\nwrite.csv(markersCD14,file = \"Data/CD14Cleaned/ClusterMarkerGenes.csv\")\nhead(markersCD14)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CL     Gene      Score      adjPVal         DEA IsMarker  logFoldCh\n1  1 HLA-DQA1 -0.3398915 2.603676e-59 -0.15274999        0 -0.5470222\n2  1 HLA-DQA2 -0.2899185 7.002901e-43 -0.12223685        0 -0.4804835\n3  1 HLA-DPA1 -0.2808830 2.589504e-40 -0.13090249        0 -0.4370669\n4  1  HLA-DRA -0.2499997 1.042557e-31 -0.10296185        0 -0.3654458\n5  1 HLA-DPB1 -0.2225778 5.652934e-25 -0.09887797        0 -0.3375752\n6  1     YBX1 -0.2095002 5.042102e-22 -0.08080263        0 -0.3784618\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncd14GDI <- calculateGDI(cd14Obj)\n\nsubsetGDI <- cd14GDI[cd14GDI$sum.raw.norm > 7,]\ntop.GDI.genes <- rownames(subsetGDI[order(subsetGDI$GDI,decreasing = T),])[1:50]\n\nGDIPlot(cd14Obj,genes = \"\",GDIIn = cd14GDI)\n```\n\n::: {.cell-output-display}\n![](cd14_clusterizations_comparisons_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- getNormalizedData(cd14Obj)\n\ndata <- data[!rowSums(as.matrix(data)) < 1,]\ndata <- log(data*10000+1)\n\nrow_stdev <- apply(data, 1, sd, na.rm=TRUE)\nrow_stdev <- row_stdev[order(row_stdev,decreasing = T)]\n\ngenes.to.keep <- c(names(row_stdev[1:100]),top.GDI.genes)\n\ndata.small <- data[rownames(data) %in% genes.to.keep,]\n\n#data <- t(as.matrix(data))\ndata.small <- t(as.matrix(data.small))\n\n\nCOTAN_Cl.code <- getClusterizationData(cd14Obj,clName = \"merge\")[[1]]\n#COTAN_Cl.code[COTAN_Cl.code == \"A549\"] <- 0\n#COTAN_Cl.code[COTAN_Cl.code == \"CCL-185-IG\"] <- 1\n\nCOTAN_Cl.code <- as.numeric(COTAN_Cl.code)\n\ndata.small <- cbind(data.small,COTAN_Cl.code)\ndata.small <- as.data.frame(data.small)\n\n# Split the data into training and test set\nset.seed(123)\ntraining.samples <- data.small[,\"COTAN_Cl.code\"] %>% \n  createDataPartition(p = 0.8, list = FALSE)\ntrain.data  <- data.small[training.samples, ]\ntest.data <- data.small[-training.samples, ]\nhead(train.data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    RPL22   LAPTM5 ATP6V0B      RPL5      MCL1      CTSS\nAAACATACCACTAG-1 9.485384 9.485384       0  0.000000  0.000000  0.000000\nAAACATACGTTCAG-1 0.000000 0.000000       0  0.000000 10.114628  0.000000\nAAACATTGCTTCGC-1 0.000000 0.000000       0  0.000000  0.000000  0.000000\nAAACATTGGGCAAG-1 9.322304 0.000000       0  8.629246  9.727739  0.000000\nAAACGGCTACGGAG-1 0.000000 0.000000       0 10.582413  9.483852 10.870089\nAAACGGCTAGTCAC-1 0.000000 9.124915       0  9.124915  0.000000  9.818008\n                   S100A10   S100A11    S100A9    S100A8    S100A6   S100A4\nAAACATACCACTAG-1  9.485384  0.000000  9.485384  9.485384  9.485384 11.56476\nAAACATACGTTCAG-1  0.000000 10.114628 11.906354 11.367363 10.807755 11.36736\nAAACATTGCTTCGC-1  9.414354 10.512912 11.493724 11.812175 11.206045 11.71687\nAAACATTGGGCAAG-1 10.238541  9.322304 10.826311 11.519449 10.420856 11.33713\nAAACGGCTACGGAG-1 10.176961  0.000000 12.191831 11.881678 10.176961 11.56323\nAAACGGCTAGTCAC-1  0.000000 10.511128 12.120544 11.763871 10.916584 11.20426\n                     VAMP8     COX5B   NBEAL1 EEF1B2     ARPC2     RPL15\nAAACATACCACTAG-1 10.583946  0.000000 9.485384      0 10.178493 11.094761\nAAACATACGTTCAG-1 10.114628  0.000000 0.000000      0  0.000000  9.421522\nAAACATTGCTTCGC-1  9.414354  0.000000 9.414354      0  9.414354  9.414354\nAAACATTGGGCAAG-1  9.727739  8.629246 9.322304      0  8.629246 11.113989\nAAACGGCTACGGAG-1 10.176961 10.176961 0.000000      0  9.483852 10.582413\nAAACGGCTAGTCAC-1  9.818008  9.818008 9.124915      0  9.818008 10.916584\n                      RPSA      GPX1     RPL29    SERP1      BTF3      CD14\nAAACATACCACTAG-1  0.000000  9.485384  0.000000 0.000000  0.000000 10.178493\nAAACATACGTTCAG-1  9.421522  9.421522  0.000000 0.000000 10.114628 10.520080\nAAACATTGCTTCGC-1  0.000000  9.414354 10.512912 0.000000  0.000000  0.000000\nAAACATTGGGCAAG-1 10.931670 10.420856 10.015406 9.322304  0.000000  0.000000\nAAACGGCTACGGAG-1  0.000000 11.429697  9.483852 0.000000  0.000000  9.483852\nAAACGGCTAGTCAC-1  0.000000 10.223455  9.124915 9.124915  9.124915  0.000000\n                    DUSP1   HIGD2A  PRELID1     HLA-E      AIF1    CLIC1\nAAACATACCACTAG-1 0.000000 9.485384 0.000000  0.000000  9.485384 10.58395\nAAACATACGTTCAG-1 9.421522 0.000000 0.000000  0.000000  9.421522  0.00000\nAAACATTGCTTCGC-1 9.414354 9.414354 0.000000  0.000000 11.206045  0.00000\nAAACATTGGGCAAG-1 9.322304 9.322304 9.727739  8.629246  9.727739  0.00000\nAAACGGCTACGGAG-1 0.000000 0.000000 0.000000  0.000000  0.000000  0.00000\nAAACGGCTAGTCAC-1 9.124915 0.000000 9.124915 10.511128  9.818008  0.00000\n                   HLA-DRA  HLA-DRB5  HLA-DRB1 HLA-DQA1  HLA-DQB1  HLA-DMA\nAAACATACCACTAG-1 10.583946 10.871621 11.883210        0 10.178493 0.000000\nAAACATACGTTCAG-1  9.421522  0.000000  9.421522        0  0.000000 0.000000\nAAACATTGCTTCGC-1  0.000000 10.107460 10.512912        0  0.000000 9.414354\nAAACATTGGGCAAG-1 10.575003 10.015406 10.575003        0  9.727739 0.000000\nAAACGGCTACGGAG-1  0.000000  9.483852  9.483852        0  0.000000 0.000000\nAAACGGCTAGTCAC-1 10.223455  0.000000  9.818008        0  9.124915 0.000000\n                 HLA-DPA1  HLA-DPB1    RPS10    SF3B5  RNASET2      RAC1\nAAACATACCACTAG-1 9.485384  9.485384 0.000000 0.000000 0.000000 10.178493\nAAACATACGTTCAG-1 0.000000  0.000000 9.421522 0.000000 0.000000  0.000000\nAAACATTGCTTCGC-1 0.000000  9.414354 0.000000 0.000000 0.000000  9.414354\nAAACATTGGGCAAG-1 0.000000 11.113989 9.727739 9.727739 8.629246  0.000000\nAAACGGCTACGGAG-1 0.000000  0.000000 0.000000 0.000000 9.483852  0.000000\nAAACGGCTAGTCAC-1 0.000000  0.000000 9.124915 0.000000 0.000000  9.124915\n                     TOMM7     PPIA CHCHD2    ARPC1B TMEM176B   SLC25A6 TIMP1\nAAACATACCACTAG-1  9.485384 0.000000      0  9.485384 0.000000 10.178493     0\nAAACATACGTTCAG-1 10.114628 9.421522      0 10.114628 0.000000 10.114628     0\nAAACATTGCTTCGC-1 10.107460 0.000000      0  0.000000 9.414354 10.512912     0\nAAACATTGGGCAAG-1  8.629246 0.000000      0  8.629246 0.000000  8.629246     0\nAAACGGCTACGGAG-1  0.000000 0.000000      0 10.176961 9.483852  0.000000     0\nAAACGGCTAGTCAC-1  0.000000 0.000000      0  9.818008 9.124915  9.124915     0\n                      CFP     CEBPD   PABPC1     EDF1      KLF6       VIM\nAAACATACCACTAG-1  0.00000  0.000000 0.000000 9.485384 10.178493 10.178493\nAAACATACGTTCAG-1 10.11463  0.000000 0.000000 0.000000 10.114628  9.421522\nAAACATTGCTTCGC-1  0.00000  9.414354 0.000000 0.000000  9.414354  0.000000\nAAACATTGGGCAAG-1 10.70853  8.629246 0.000000 9.322304 10.015406  9.727739\nAAACGGCTACGGAG-1  0.00000 11.093229 0.000000 0.000000 10.176961  0.000000\nAAACGGCTAGTCAC-1  0.00000 10.223455 9.818008 0.000000  0.000000  9.818008\n                     SRGN   TALDO1     LSP1   MS4A6A    NEAT1    ATP5L     TPI1\nAAACATACCACTAG-1 9.485384 0.000000 9.485384 9.485384 0.000000 0.000000 0.000000\nAAACATACGTTCAG-1 0.000000 9.421522 0.000000 0.000000 9.421522 0.000000 0.000000\nAAACATTGCTTCGC-1 0.000000 0.000000 0.000000 0.000000 9.414354 9.414354 0.000000\nAAACATTGGGCAAG-1 8.629246 0.000000 9.727739 0.000000 9.322304 0.000000 8.629246\nAAACGGCTACGGAG-1 9.483852 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000\nAAACGGCTAGTCAC-1 9.124915 9.124915 0.000000 9.818008 0.000000 0.000000 0.000000\n                  ARHGDIB     CD63      NACA LINC00936     ARPC3   ATP5EP2\nAAACATACCACTAG-1 0.000000 0.000000  0.000000  0.000000 10.178493  0.000000\nAAACATACGTTCAG-1 0.000000 9.421522  9.421522 10.114628  0.000000  9.421522\nAAACATTGCTTCGC-1 9.414354 0.000000  0.000000  0.000000  9.414354 10.512912\nAAACATTGGGCAAG-1 8.629246 8.629246  9.727739  8.629246  0.000000  8.629246\nAAACGGCTACGGAG-1 0.000000 0.000000 10.176961  9.483852  9.483852  0.000000\nAAACGGCTAGTCAC-1 9.124915 9.124915  0.000000  0.000000  9.818008  9.124915\n                     TPT1    PSME1     PSME2   NFKBIA   RPL36AL     NPC2\nAAACATACCACTAG-1 0.000000 0.000000 10.178493 0.000000  0.000000 9.485384\nAAACATACGTTCAG-1 9.421522 9.421522  0.000000 0.000000  9.421522 0.000000\nAAACATTGCTTCGC-1 9.414354 0.000000  0.000000 0.000000  0.000000 0.000000\nAAACATTGGGCAAG-1 0.000000 8.629246  9.322304 9.322304  9.322304 0.000000\nAAACGGCTACGGAG-1 0.000000 0.000000  9.483852 0.000000 10.176961 0.000000\nAAACGGCTAGTCAC-1 9.818008 0.000000  9.818008 9.124915  9.124915 9.818008\n                    CRIP1    ANXA2     RPL4    TCEB2   CORO1A    PYCARD\nAAACATACCACTAG-1  0.00000 0.000000 10.58395 0.000000 9.485384 10.871621\nAAACATACGTTCAG-1  0.00000 9.421522 10.11463 9.421522 0.000000  0.000000\nAAACATTGCTTCGC-1  0.00000 0.000000  0.00000 0.000000 9.414354  9.414354\nAAACATTGGGCAAG-1 10.42086 9.322304  0.00000 0.000000 8.629246  9.727739\nAAACGGCTACGGAG-1  0.00000 9.483852  0.00000 0.000000 0.000000 10.176961\nAAACGGCTAGTCAC-1  0.00000 0.000000  0.00000 0.000000 9.124915  9.818008\n                    COTL1     APRT   GABARAP    EIF4A1 UBB     RPL23 GRN\nAAACATACCACTAG-1 0.000000 0.000000  9.485384  0.000000   0  0.000000   0\nAAACATACGTTCAG-1 0.000000 0.000000  9.421522  0.000000   0  9.421522   0\nAAACATTGCTTCGC-1 0.000000 0.000000  0.000000 10.107460   0  9.414354   0\nAAACATTGGGCAAG-1 0.000000 8.629246  8.629246  9.322304   0 10.015406   0\nAAACGGCTACGGAG-1 0.000000 0.000000 10.176961  0.000000   0  0.000000   0\nAAACGGCTAGTCAC-1 9.124915 0.000000  9.124915  0.000000   0  0.000000   0\n                     RPL38    ACTG1    SCAND1    PSMA7     RPS21       CFD\nAAACATACCACTAG-1  0.000000 0.000000  9.485384  0.00000  0.000000  9.485384\nAAACATACGTTCAG-1 10.114628 0.000000  0.000000  0.00000  9.421522  0.000000\nAAACATTGCTTCGC-1  0.000000 0.000000  0.000000 10.51291 10.107460 10.512912\nAAACATTGGGCAAG-1  8.629246 9.322304  0.000000 10.01541  8.629246  0.000000\nAAACGGCTACGGAG-1  0.000000 0.000000 10.176961  0.00000  9.483852  0.000000\nAAACGGCTAGTCAC-1  0.000000 9.124915  9.818008 10.22345  9.818008  9.124915\n                     GPX4     ATP5D  UQCR11.1  NDUFA11 C19orf43     JUNB\nAAACATACCACTAG-1 11.88321  0.000000  0.000000 0.000000 9.485384 0.000000\nAAACATACGTTCAG-1  0.00000  0.000000 10.114628 9.421522 0.000000 0.000000\nAAACATTGCTTCGC-1  0.00000  0.000000  0.000000 0.000000 0.000000 9.414354\nAAACATTGGGCAAG-1  0.00000  8.629246  9.727739 9.322304 8.629246 0.000000\nAAACGGCTACGGAG-1  0.00000 10.176961  0.000000 9.483852 0.000000 0.000000\nAAACGGCTAGTCAC-1  0.00000  0.000000  0.000000 9.818008 0.000000 0.000000\n                      IER2     PGLS      JUND   NDUFA13     FXYD5   COX6B1\nAAACATACCACTAG-1  0.000000 0.000000  9.485384  0.000000  0.000000 9.485384\nAAACATACGTTCAG-1 11.030895 0.000000  0.000000 10.114628  0.000000 9.421522\nAAACATTGCTTCGC-1  9.414354 0.000000  9.414354 10.107460 10.107460 0.000000\nAAACATTGGGCAAG-1  0.000000 8.629246  8.629246  0.000000  9.322304 8.629246\nAAACGGCTACGGAG-1  0.000000 0.000000 10.176961  9.483852  0.000000 9.483852\nAAACGGCTAGTCAC-1 11.427402 0.000000  9.124915  9.124915  0.000000 9.818008\n                     HCST    TYROBP      GMFG    ZFP36    BLVRB     FOSB\nAAACATACCACTAG-1 0.000000 10.178493  0.000000 0.000000 0.000000 0.000000\nAAACATACGTTCAG-1 0.000000 10.807755 10.114628 0.000000 0.000000 9.421522\nAAACATTGCTTCGC-1 0.000000 10.800587  9.414354 0.000000 0.000000 9.414354\nAAACATTGGGCAAG-1 8.629246 10.575003  9.322304 0.000000 9.322304 0.000000\nAAACGGCTACGGAG-1 0.000000  9.483852  0.000000 0.000000 9.483852 0.000000\nAAACGGCTAGTCAC-1 0.000000 11.522711  9.124915 9.818008 9.124915 9.818008\n                     AP2S1   GLTSCR2      EMP3     FCGRT      RPS5    LGALS2\nAAACATACCACTAG-1  0.000000  9.485384  9.485384  0.000000  9.485384 10.178493\nAAACATACGTTCAG-1  0.000000  9.421522  0.000000  0.000000  0.000000  0.000000\nAAACATTGCTTCGC-1  0.000000  0.000000  9.414354  0.000000 10.107460  0.000000\nAAACATTGGGCAAG-1  8.629246  0.000000 10.826311  0.000000 10.015406  9.727739\nAAACGGCTACGGAG-1 10.176961  0.000000 10.870089 10.176961 10.176961  0.000000\nAAACGGCTAGTCAC-1  0.000000 10.223455  0.000000  9.124915  0.000000  0.000000\n                   MT-ND2  MT-ATP6   MT-ND4   MT-CYB COTAN_Cl.code\nAAACATACCACTAG-1 0.000000 0.000000 9.485384 0.000000             1\nAAACATACGTTCAG-1 0.000000 9.421522 0.000000 9.421522             1\nAAACATTGCTTCGC-1 0.000000 9.414354 0.000000 9.414354             1\nAAACATTGGGCAAG-1 8.629246 9.727739 0.000000 8.629246             2\nAAACGGCTACGGAG-1 0.000000 0.000000 0.000000 9.483852             1\nAAACGGCTAGTCAC-1 9.124915 9.124915 0.000000 0.000000             1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain.data$COTAN_Cl.code <- as.factor(train.data$COTAN_Cl.code)\ntest.data$COTAN_Cl.code <- as.factor(test.data$COTAN_Cl.code)\n# Fit the model\n#model <- glm( COTAN_Cl.code ~., data = train.data, family = binomial,control = list(maxit = 75))\nmodel <- multinom(COTAN_Cl.code ~ ., data = train.data, maxit = 500)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# weights:  369 (244 variable)\ninitial  value 2143.392575 \niter  10 value 761.340646\niter  20 value 746.268326\niter  30 value 720.679315\niter  40 value 579.207155\niter  50 value 545.792232\niter  60 value 539.711792\niter  70 value 526.902032\niter  80 value 506.380523\niter  90 value 485.108188\niter 100 value 480.679083\niter 110 value 476.395523\niter 120 value 462.778421\niter 130 value 457.035815\niter 140 value 455.285417\niter 150 value 449.873877\niter 160 value 446.861152\niter 170 value 444.452737\niter 180 value 439.972413\niter 190 value 437.990151\niter 200 value 437.057149\niter 210 value 436.908590\niter 220 value 436.792687\niter 230 value 436.667356\niter 240 value 436.372853\niter 250 value 435.784259\niter 260 value 435.132550\niter 270 value 434.964836\niter 280 value 434.951070\niter 290 value 434.949618\niter 300 value 434.949374\nfinal  value 434.949335 \nconverged\n```\n:::\n\n```{.r .cell-code}\nprobabilities <- predict(model, newdata = test.data, type = \"probs\")\n\n# Find the class with the highest probability for each case\npredicted.classes <- apply(probabilities, 1, which.max)\n\n# Adjust predicted classes to match your factor levels\nlevels <- levels(train.data$COTAN_Cl.code)\npredicted.classes <- levels[predicted.classes]\n\n# Calculate model accuracy\naccuracy <- mean(predicted.classes == test.data$COTAN_Cl.code)\n#result.df[nrow(result.df),\"Accuracy\"] <- accuracy\nprint(accuracy)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8521561\n```\n:::\n:::\n\n\nSo the logistic regression accuracy for COTAN three clusters is quite good.\n\n![Cluster 1 top enriched genes. In red enriched Reactome Pathways innate immune system genes.](Data/CD14Cleaned/FromStringrEnrichr/CD14Cluster1.png){fig-align=\"center\"}\n\n![cluster 2 - 100 top enriched genes. In red Antigen processing and presentation of exogenous peptide antigen via MHC class II genes, in violet Regulation of leukocyte cell-cell adhesion (GO Biological Process) and in green Adaptive Immune System](Data/CD14Cleaned/FromStringrEnrichr/CD14Cluster2string_vector_graphic.png){fig-align=\"center\"}\n\n![Cluster 3 - 100 top enriched genes. In violet Cytokine Signaling in Immune system and in red Immunoregulatory interactions between a Lymphoid and a non-Lymphoid cell enriched genes for Reatome Pathways.](Data/CD14Cleaned/FromStringrEnrichr/CD14Cluster3.png){fig-align=\"center\"}\n\nThe cells in cluster 1 seem to be classical CD14 monocytes since they express CD14 while depleted in MHC class II proteins complex which is enriched in cell cluster 2 that seems intermediate monocytes.\n\nCluster 3 does not seem to be a monocyte cluster. Using enrichr website it is enriched in Plasmacytoid Dendritic cell marker genes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.4.0 (2024-04-24)\nPlatform: x86_64-pc-linux-gnu\nRunning under: Ubuntu 20.04.6 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 \nLAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       \n [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   \n [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          \n[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   \n\ntime zone: Europe/Rome\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] nnet_7.3-19        stringr_1.5.1      caret_6.0-94       lattice_0.22-6    \n [5] COTAN_2.5.2        assertthat_0.2.1   zeallot_0.1.0      tibble_3.2.1      \n [9] ggsankey_0.0.99999 ggplot2_3.5.1      rlang_1.1.3       \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.4.0            \n  [3] later_1.3.2               polyclip_1.10-6          \n  [5] hardhat_1.3.1             pROC_1.18.5              \n  [7] rpart_4.1.23              fastDummies_1.7.3        \n  [9] lifecycle_1.0.4           doParallel_1.0.17        \n [11] globals_0.16.3            MASS_7.3-60.2            \n [13] dendextend_1.17.1         magrittr_2.0.3           \n [15] plotly_4.10.4             rmarkdown_2.27           \n [17] yaml_2.3.8                httpuv_1.6.15            \n [19] Seurat_5.1.0              sctransform_0.4.1        \n [21] spam_2.10-0               askpass_1.2.0            \n [23] sp_2.1-4                  spatstat.sparse_3.0-3    \n [25] reticulate_1.37.0         cowplot_1.1.3            \n [27] pbapply_1.7-2             RColorBrewer_1.1-3       \n [29] lubridate_1.9.3           abind_1.4-5              \n [31] zlibbioc_1.50.0           Rtsne_0.17               \n [33] purrr_1.0.2               BiocGenerics_0.50.0      \n [35] ipred_0.9-14              lava_1.8.0               \n [37] circlize_0.4.16           IRanges_2.38.0           \n [39] S4Vectors_0.42.0          ggrepel_0.9.5            \n [41] irlba_2.3.5.1             listenv_0.9.1            \n [43] spatstat.utils_3.0-4      umap_0.2.10.0            \n [45] goftest_1.2-3             RSpectra_0.16-1          \n [47] spatstat.random_3.2-3     dqrng_0.4.0              \n [49] fitdistrplus_1.1-11       parallelly_1.37.1        \n [51] DelayedMatrixStats_1.26.0 leiden_0.4.3.1           \n [53] codetools_0.2-20          DelayedArray_0.30.1      \n [55] tidyselect_1.2.1          shape_1.4.6.1            \n [57] farver_2.1.2              ScaledMatrix_1.12.0      \n [59] viridis_0.6.5             matrixStats_1.3.0        \n [61] stats4_4.4.0              spatstat.explore_3.2-7   \n [63] jsonlite_1.8.8            GetoptLong_1.0.5         \n [65] progressr_0.14.0          ggridges_0.5.6           \n [67] survival_3.6-4            iterators_1.0.14         \n [69] foreach_1.5.2             tools_4.4.0              \n [71] ica_1.0-3                 Rcpp_1.0.12              \n [73] glue_1.7.0                prodlim_2023.08.28       \n [75] gridExtra_2.3             SparseArray_1.4.5        \n [77] xfun_0.44                 MatrixGenerics_1.16.0    \n [79] ggthemes_5.1.0            dplyr_1.1.4              \n [81] withr_3.0.0               fastmap_1.2.0            \n [83] fansi_1.0.6               openssl_2.2.0            \n [85] digest_0.6.35             rsvd_1.0.5               \n [87] timechange_0.3.0          parallelDist_0.2.6       \n [89] R6_2.5.1                  mime_0.12                \n [91] colorspace_2.1-0          scattermore_1.2          \n [93] tensor_1.5                spatstat.data_3.0-4      \n [95] utf8_1.2.4                tidyr_1.3.1              \n [97] generics_0.1.3            data.table_1.15.4        \n [99] recipes_1.0.10            class_7.3-22             \n[101] httr_1.4.7                htmlwidgets_1.6.4        \n[103] S4Arrays_1.4.1            ModelMetrics_1.2.2.2     \n[105] uwot_0.2.2                pkgconfig_2.0.3          \n[107] gtable_0.3.5              timeDate_4032.109        \n[109] ComplexHeatmap_2.20.0     lmtest_0.9-40            \n[111] XVector_0.44.0            htmltools_0.5.8.1        \n[113] dotCall64_1.1-1           clue_0.3-65              \n[115] SeuratObject_5.0.2        scales_1.3.0             \n[117] png_0.1-8                 gower_1.0.1              \n[119] knitr_1.46                rstudioapi_0.16.0        \n[121] reshape2_1.4.4            rjson_0.2.21             \n[123] nlme_3.1-164              zoo_1.8-12               \n[125] GlobalOptions_0.1.2       KernSmooth_2.23-24       \n[127] parallel_4.4.0            miniUI_0.1.1.1           \n[129] RcppZiggurat_0.1.6        pillar_1.9.0             \n[131] grid_4.4.0                vctrs_0.6.5              \n[133] RANN_2.6.1                promises_1.3.0           \n[135] BiocSingular_1.20.0       beachmat_2.20.0          \n[137] xtable_1.8-4              cluster_2.1.6            \n[139] evaluate_0.23             cli_3.6.2                \n[141] compiler_4.4.0            crayon_1.5.2             \n[143] future.apply_1.11.2       labeling_0.4.3           \n[145] plyr_1.8.9                stringi_1.8.4            \n[147] viridisLite_0.4.2         deldir_2.0-4             \n[149] BiocParallel_1.38.0       munsell_0.5.1            \n[151] lazyeval_0.2.2            spatstat.geom_3.2-9      \n[153] PCAtools_2.16.0           Matrix_1.7-0             \n[155] RcppHNSW_0.6.0            patchwork_1.2.0          \n[157] sparseMatrixStats_1.16.0  future_1.33.2            \n[159] shiny_1.8.1.1             ROCR_1.0-11              \n[161] Rfast_2.1.0               igraph_2.0.3             \n[163] RcppParallel_5.1.7       \n```\n:::\n:::\n",
    "supporting": [
      "cd14_clusterizations_comparisons_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}